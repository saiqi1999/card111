# Cardgame111 - 卡牌游戏项目

这是一个使用Godot 4.4.1引擎开发的卡牌游戏项目。

## 项目结构

- `assets/` - 游戏资源文件夹
  - `images/` - 图像资源
- `scenes/` - 游戏场景文件夹
  - `root.tscn` - 主场景
  - `card.tscn` - 卡牌场景
  - `debug.tscn` - 调试场景
- `scripts/` - 游戏脚本文件夹
  - `cards/` - 卡牌系统相关脚本
  - `debug/` - 调试相关脚本
  - `mobs/` - 怪物相关脚本
  - `utils/` - 全局工具脚本
  - `ctrl/` - 控制器系统脚本
    - `ctrl_base.gd` - 控制器基类
    - `ctrl_util.gd` - 控制器工具类
    - `prefabs/` - 控制器预制件目录
      - `ctrl_400x300_pack.gd` - 小控制器预制件

## 功能概述

### 卡牌系统

项目实现了完整的卡包系统和卡牌交互功能：

- `CardPackBase` - 卡包基类，提供卡牌管理的基本功能
- `prefabs/StrikeCardPack` - 打击卡包，继承自卡包基类，位于prefabs文件夹
- `prefabs/DefendCardPack` - 防御卡包，继承自卡包基类，位于prefabs文件夹
- `prefabs/WantSlimeCardPack` - Want Slime卡包，继承自卡包基类
- `prefabs/BasicSkillPackCardPack` - Basic Skill Pack卡包，继承自卡包基类
- `CardUtil` - 卡牌工具类，提供卡牌显示、拖拽、移动和堆叠功能

### 控制器系统

控制器系统用于在游戏中显示和管理各种UI界面，如背包、商店界面等。采用Control+简化位置设置的UI实现方式，并使用Godot的Autoload机制实现单例模式。

- **Control实现**：基于Godot原生Control节点，享受完整的UI系统支持
- **简化布局**：使用简单的位置设置替代复杂的Anchor系统，避免显示问题
- **响应式缩放**：控制器尺寸根据屏幕分辨率动态调整为屏幕的四分之一
- **固定定位**：控制器固定在左下角，距离边缘100像素
- **Autoload单例**：使用Godot官方推荐的Autoload机制实现单例模式，确保全局唯一性
- **全局访问**：通过Autoload名称（如Ctrl400x300）在任何脚本中直接访问
- **内存安全**：Godot引擎自动管理Autoload生命周期，避免内存泄漏
- **动态内容**：支持动态设置标题和描述，适应不同使用场景
- **类型系统**：通过类型字符串管理不同控制器类型，易于扩展
- **生命周期管理**：完善的创建、初始化和销毁流程
- **UI层级**：基于Control的自然层级管理，无需手动设置z_index
- **纹理背景**：支持StyleBoxTexture背景纹理显示，提供丰富的视觉效果
- **模块化设计**：采用基类+子类架构，支持不同类型控制器的扩展

#### 卡牌交互功能

- **卡牌拖拽**：支持鼠标拖拽卡牌，使用全局鼠标跟踪技术，无论移动多快都能精确跟随
- **动画系统**：支持卡牌平滑移动动画，使用Tween系统实现
- **冲突处理**：拖拽时自动停止正在进行的移动动画，避免冲突
- **模块化设计**：`move_card`方法独立实现，支持代码复用
- **层级管理**：实现了卡牌层级管理系统，解决多张卡牌重叠时的点击检测问题
- **智能点击**：只有最上层的卡牌响应鼠标点击，点击时自动置顶
- **卡牌注册**：自动管理所有卡牌实例，支持失效卡牌的自动清理
- **个性化点击效果**：每张卡牌支持自定义点击效果，通过`on_click`属性实现个性化交互

### 全局工具系统

项目实现了全局工具系统、统一的日志管理和全局常量配置：

- `GlobalUtil` - 全局工具类，提供通用工具方法和日志管理
- `GlobalConstants` - 全局常量类，定义游戏中使用的所有常量配置
- `GlobalUtilLoader` - 全局工具加载器，负责初始化全局工具实例和常量

#### 日志系统功能

- **统一日志接口**：所有打印操作通过`GlobalUtil.log`方法统一管理
- **日志级别**：支持DEBUG、INFO、WARNING、ERROR四个级别
- **动态控制**：运行时可通过命令开启/关闭日志输出
- **性能优化**：关闭日志输出可显著提升游戏性能

#### 全局常量系统功能

- **统一配置**：所有游戏常量集中在`GlobalConstants`类中管理
- **类型安全**：使用强类型定义，避免硬编码错误
- **易于维护**：修改常量值只需在一个地方进行
- **配置分类**：按功能分类组织常量（卡牌、动画、屏幕位置等）
- **自动加载**：通过`GlobalUtilLoader`自动注册为全局单例

### 调试界面

调试场景提供了丰富的测试功能：

#### 按钮功能
- 点击按钮创建三张不同位置的卡牌

#### 命令系统
调试界面支持以下命令（在输入框中输入并按回车）：
- `hello` - 显示问候信息
- `reboot` - 重启root节点，清除所有卡牌并重新初始化
- `slide` - 创建滑动卡牌，从屏幕左侧滑动到中央
- `random` - 创建随机移动卡牌，移动到非中心区域
- `overlap` - 创建5张重叠卡牌，测试层级管理功能（使用卡牌池系统，解决首次拖拽延迟问题）
- `log on` - 开启日志输出
- `log off` - 关闭日志输出
- `help` - 显示所有可用命令和当前日志状态

#### 卡牌交互
- **拖拽功能**：所有创建的卡牌都支持鼠标拖拽，支持单张和多张卡牌拖拽
- **层级管理**：重叠卡牌时只有最上层响应点击，拖拽时自动将卡牌组移到最前面
- **智能点击**：单纯点击不改变卡牌层级，只有拖拽时才将卡牌移到最前面
- **卡牌堆叠**：支持卡牌堆叠功能，可将多张卡牌组合成堆叠
- **连带拖拽**：拖拽堆叠中的卡牌时，会连带拖拽堆叠中的其他卡牌

## 开发计划

### 已完成功能
- [x] 卡包系统基础架构
- [x] 卡牌显示和交互系统
- [x] 卡牌拖拽和动画系统
- [x] 全局工具系统
- [x] 统一日志管理系统
- [x] 卡牌层级管理系统
- [x] 调试界面和命令系统
- [x] 控制器系统基础架构
- [x] 控制器UI布局和响应式设计
- [x] 控制器Autoload单例模式实现
- [x] 控制器动态标题描述系统
- [x] 控制器纹理背景显示系统
- [x] 控制器与卡牌系统的Autoload集成
- [x] 多种卡牌类型实现（打击、防御、Want Slime、Basic Skill Pack）
- [x] 代码结构优化和重构
- [x] 控制器类型系统和扩展机制
- [x] 控制器与卡牌系统集成
- [x] 控制器UI元素显示和布局优化
- [x] 控制器简化位置设置系统（替代复杂Anchor系统）
- [x] 控制器可见性问题修复和显示优化
- [x] 卡牌堆叠系统实现
- [x] 卡牌智能点击逻辑优化
- [x] 多张卡牌连带拖拽功能
- [x] 卡牌层级管理系统优化

### 待开发功能
- [ ] 实现卡牌基类
- [ ] 实现怪物基类
- [ ] 实现战斗系统
- [ ] 实现回合系统
- [ ] 实现资源系统

## 开发环境

- Godot 4.4.1
- GDScript

## 如何运行

1. 使用Godot 4.4.1或更高版本打开项目
2. 点击编辑器中的运行按钮或按F5启动游戏