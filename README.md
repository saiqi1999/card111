# Cardgame111 - 卡牌游戏项目

这是一个使用Godot 4.4.1引擎开发的卡牌游戏项目。

## 项目结构

- `assets/` - 游戏资源文件夹
  - `images/` - 图像资源
- `scenes/` - 游戏场景文件夹
  - `root.tscn` - 主场景
  - `card.tscn` - 卡牌场景
  - `debug.tscn` - 调试场景
- `scripts/` - 游戏脚本文件夹
  - `cards/` - 卡牌系统相关脚本
  - `debug/` - 调试相关脚本
  - `mobs/` - 怪物相关脚本
  - `utils/` - 全局工具脚本

## 功能概述

### 卡牌系统

项目实现了完整的卡包系统和卡牌交互功能：

- `CardPackBase` - 卡包基类，提供卡牌管理的基本功能
- `prefabs/StrikeCardPack` - 打击卡包，继承自卡包基类，位于prefabs文件夹
- `prefabs/DefendCardPack` - 防御卡包，继承自卡包基类，位于prefabs文件夹
- `CardUtil` - 卡牌工具类，提供卡牌显示、拖拽和移动功能

### 容器系统

- **容器显示**：使用Sprite2D显示容器背景，支持多种尺寸规格
- **精确点击检测**：使用Area2D实现精确的点击检测，检测范围与视觉显示完全匹配
- **智能交互逻辑**：优先检测卡牌和可拖拽元素，避免容器拦截卡牌事件
- **层级管理**：容器z_index设置为100，确保容器纹理显示在卡牌上方
- **事件处理优化**：重新组织事件处理优先级，确保卡牌交互不被容器干扰
- **模块化设计**：采用基类+子类架构，支持不同类型容器的扩展

#### 卡牌交互功能

- **卡牌拖拽**：支持鼠标拖拽卡牌，使用全局鼠标跟踪技术，无论移动多快都能精确跟随
- **动画系统**：支持卡牌平滑移动动画，使用Tween系统实现
- **冲突处理**：拖拽时自动停止正在进行的移动动画，避免冲突
- **模块化设计**：`move_card`方法独立实现，支持代码复用
- **层级管理**：实现了卡牌层级管理系统，解决多张卡牌重叠时的点击检测问题
- **智能点击**：只有最上层的卡牌响应鼠标点击，点击时自动置顶
- **卡牌注册**：自动管理所有卡牌实例，支持失效卡牌的自动清理
- **个性化点击效果**：每张卡牌支持自定义点击效果，通过`on_click`属性实现个性化交互

### 全局工具系统

项目实现了全局工具系统、统一的日志管理和全局常量配置：

- `GlobalUtil` - 全局工具类，提供通用工具方法和日志管理
- `GlobalConstants` - 全局常量类，定义游戏中使用的所有常量配置
- `GlobalUtilLoader` - 全局工具加载器，负责初始化全局工具实例和常量

#### 日志系统功能

- **统一日志接口**：所有打印操作通过`GlobalUtil.log`方法统一管理
- **日志级别**：支持DEBUG、INFO、WARNING、ERROR四个级别
- **动态控制**：运行时可通过命令开启/关闭日志输出
- **性能优化**：关闭日志输出可显著提升游戏性能

#### 全局常量系统功能

- **统一配置**：所有游戏常量集中在`GlobalConstants`类中管理
- **类型安全**：使用强类型定义，避免硬编码错误
- **易于维护**：修改常量值只需在一个地方进行
- **配置分类**：按功能分类组织常量（卡牌、动画、屏幕位置等）
- **自动加载**：通过`GlobalUtilLoader`自动注册为全局单例

### 调试界面

调试场景提供了丰富的测试功能：

#### 按钮功能
- 点击按钮创建三张不同位置的卡牌

#### 命令系统
调试界面支持以下命令（在输入框中输入并按回车）：
- `hello` - 显示问候信息
- `reboot` - 重启root节点，清除所有卡牌并重新初始化
- `slide` - 创建滑动卡牌，从屏幕左侧滑动到中央
- `random` - 创建随机移动卡牌，移动到非中心区域
- `overlap` - 创建5张重叠卡牌，测试层级管理功能（使用卡牌池系统，解决首次拖拽延迟问题）
- `log on` - 开启日志输出
- `log off` - 关闭日志输出
- `help` - 显示所有可用命令和当前日志状态

#### 卡牌交互
- **拖拽功能**：所有创建的卡牌都支持鼠标拖拽
- **层级管理**：重叠卡牌时只有最上层响应点击
- **自动置顶**：点击卡牌时自动将其置于最上层

## 开发计划

### 已完成功能
- [x] 卡包系统基础架构
- [x] 卡牌显示和交互系统
- [x] 卡牌拖拽和动画系统
- [x] 全局工具系统
- [x] 统一日志管理系统
- [x] 卡牌层级管理系统
- [x] 调试界面和命令系统
- [x] 容器系统基础架构
- [x] 容器点击检测和交互
- [x] 容器层级管理和事件处理优化
- [x] 代码结构优化和重构

### 待开发功能
- [ ] 实现卡牌基类
- [ ] 实现怪物基类
- [ ] 实现战斗系统
- [ ] 实现回合系统
- [ ] 实现资源系统

## 开发环境

- Godot 4.4.1
- GDScript

## 如何运行

1. 使用Godot 4.4.1或更高版本打开项目
2. 点击编辑器中的运行按钮或按F5启动游戏