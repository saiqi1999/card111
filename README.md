# 卡牌游戏项目 (Card Game Project)

## 项目结构

```
/
├── scripts/
│   ├── cards/           # 卡牌系统
│   │   ├── prefabs/    # 卡牌预制体
│   │   └── ...
│   ├── utils/          # 工具类
│   │   ├── area_util.gd    # 区域管理工具
│   │   ├── camera_ctrl.gd  # 相机控制
│   │   ├── card_util.gd    # 卡牌工具
│   │   └── ...
│   └── ...
└── README.md           # 本文档
```

## 核心系统

### 1. 卡牌系统

卡牌系统由以下核心组件构成：

1. **CardPackBase**：卡包基类，定义卡牌基本属性和行为，包含标签系统
2. **CardUtil**：卡牌工具类，提供卡牌管理和交互功能，包含完整的资源清理机制
3. **卡牌预制体**：各类卡牌的具体实现
4. **装饰器系统**：使用装饰器模式为卡牌动态添加行为和标签，支持完整的生命周期管理

#### 装饰器系统

装饰器系统基于装饰器设计模式，为卡牌提供动态行为扩展：

- **CardDecoratorBase**：装饰器基类，定义装饰器生命周期方法
- **FixedDecorator**：固定装饰器，禁用卡牌拖拽功能
- **CardDecoratorManager**：装饰器管理器，统一管理卡牌装饰器，支持自动初始化和完整清理

装饰器系统与标签系统深度集成，通过标签状态管理装饰器的生命周期，确保资源的正确分配和回收。

**使用示例：**
```gdscript
# 添加固定装饰器，防止卡牌被拖动
card.add_fixed_decorator()

# 检查卡牌是否被固定
if card.is_fixed():
    print("卡牌已被固定")

# 移除固定装饰器
card.remove_fixed_decorator()
```

详细信息请参考 [卡牌系统文档](scripts/cards/README.md) 和 [装饰器系统文档](scripts/cards/decorators/README.md)

### 2. 区域管理系统

区域管理系统负责控制游戏中各个元素的移动范围，主要包括：

1. **相机移动范围**
   - 定义相机可移动的边界区域
   - 通过`CAMERA_MOVE_BOUNDS_MIN`和`CAMERA_MOVE_BOUNDS_SIZE`控制
   - 确保相机始终在有效范围内移动

2. **卡牌移动范围**
   - 限制卡牌的活动区域
   - 通过`CARD_MOVE_BOUNDS_MIN`和`CARD_MOVE_BOUNDS_SIZE`控制
   - 应用于所有卡牌移动操作：
     * 拖拽移动
     * 随机移动
     * 瞬间移动

3. **遮罩层系统**
   - 使用 5x5 网格管理遮罩层，覆盖从 (-2,-2) 到 (2,2) 的区域
   - 通过`FOG_GRID_MIN`和`FOG_GRID_SIZE`控制遮罩层位置和大小
   - 初始状态：
     * (0,0) 位置不可见（玩家初始区域）
     * 其他位置可见（待探索区域）
   - 支持动态控制每个遮罩层的可见性

4. **边界检查机制**
   - 自动将超出范围的位置限制在边界内
   - 保证游戏元素始终在可见区域内
   - 提供平滑的边界过渡

### 3. 天气系统

天气系统通过事件定时器定期生成天气卡牌，为游戏增添动态变化：

1. **天气类型**
   - 刮风：带来清新的空气
   - 下雨：滋润大地万物

2. **生成机制**
   - 每120秒触发一次天气检查
   - 30%概率生成天气卡牌
   - 随机选择天气类型
   - 在屏幕范围内随机生成位置

3. **天气效果**
   - 天气卡牌会在生成后随机移动
   - 持续120秒后自动消失
   - 可以通过点击触发特殊效果

### 4. 合成系统

合成系统是游戏的核心玩法之一，允许玩家将多张卡牌组合成新的卡牌：

1. **配方管理**
   - 支持多种配方定义（原料 → 产物）
   - 配方数据存储在 `RecipeConstant` 中
   - 支持动态添加新配方

2. **合成流程**
   - 将符合配方的卡牌堆叠在一起
   - 系统自动检测配方匹配
   - 显示合成进度条
   - 合成完成后生成产物卡牌

3. **进度管理**
   - 实时显示合成进度
   - 支持拖拽移动时保持合成状态
   - 合成任务可以在堆叠间转移

4. **特殊功能**
   - 部分卡牌有合成次数限制
   - 支持一对多的合成产物
   - 合成完成后触发卡牌特殊效果

### 5. 卡牌交互

卡牌系统支持多种交互方式：

1. **创建与回收**
   - 使用卡牌池系统管理卡牌实例
   - 支持自动回收和手动回收

2. **移动操作**
   - 拖拽移动：用户可以自由拖拽卡牌
   - 随机移动：系统随机选择目标位置
   - 瞬间移动：直接将卡牌移动到目标位置

3. **堆叠系统**
   - 支持卡牌自动堆叠
   - 管理卡牌组的层级关系
   - 智能合成检测和状态保持

## 开发环境

- Godot 4.4.1
- GDScript

## 注意事项

1. 创建新卡牌时使用卡牌池系统
2. 移动卡牌时使用CardUtil提供的方法
3. 确保正确处理卡牌的生命周期
4. 注意边界检查和范围限制